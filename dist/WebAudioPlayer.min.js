var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{S1:()=>init,W4:()=>startup,i8:()=>n});const get=async(e,t=null)=>{let n=e;if(t){n=`${n}?${new URLSearchParams(t).toString}`}const o={headers:new Headers({"Content-Type":"application/json","X-Requested-With":""}),method:"GET",mode:"same-origin"},a=await fetch(n,o);if(!a.ok)throw new Error("Bad");return await a.json()},_log=(e,t)=>{console.log(t)},error=e=>{_log(0,e)},n="0.7";let o,a={mp3:["audio/mpeg","audio/MPA","audio/mpa-robust","audio/mpeg3","audio/x-mpeg-3"],mp4:["audio/aac","audio/aacp","audio/3gpp","audio/3gpp2","audio/mp4","audio/MP4A-LATM","audio/mpeg4-generic"],ogg:["application/ogg","audio/oga","audio/ogg","audio/vorbis","audio/vorbis-config"],webm:["audio/webm"],wav:["audio/vnd.wave","audio/wav","audio/wave","audio/x-wav"]},l=null,i=!1,s=null,r=!1,d=null,c=[],u=null,p=[],f=0,y=0,g=".net-stat-box",_=".autoplay-btn",m=".current-time",v=".info-button",B=".info-screen",h=".info-scroll-box",T=".info-content-box",k=".loading-bar",S=".mute-button",b=".next-track-btn",x=".play-btn",C=".playlist-scroll-box",E=".playlist-btn",P=".prev-track-btn",L=".remaining-time",w=".seek-handle-box",N=".screen-title",A=".user-screen",H=".volume-slider-mute-box",M=".volume-button",j=".volume-slider",I={ajaxSpinner:{},autoplayBtn:{},currentTimeDisplay:null,infoButton:{},infoScreen:{},infoScroll:null,infoScrollContent:null,loadProgress:{},muteButton:{},nextTrackBtn:{},playBtn:{},playlistBox:null,playlistBtn:{},prevTrackBtn:{},remainingTime:null,seekHandleBox:{},screenTitle:null,userScreen:{},volumeButton:{},volumeSliderMute:{},volumeSlider:{}};const startup=e=>{window.document.addEventListener("DOMContentLoaded",(t=>{const n=window.document.getElementById(e);init(n,window.document)}))},init=(e,t,n=null)=>{d=e,o=t,r=function _checkWebAudioApiSupport(){const e=typeof Audio;return"function"==e||"object"==e}();try{if(!r)throw new Error("Web Audio is not supported on your device :(");if(d.classList.add("paused"),function _setAudioObject(e=null){l=e??new Audio}(n),!function _checkMimeSupport(){var e="";for(let t in a)for(let n in a[t])if("probably"===(e=_canPlayType(a[t][n]))||"maybe"===e)return t;return!1}())throw new Error("There is no audio codec supported for this device.");return function _setUpFunctionality(){I.ajaxSpinner={node:_getNodeByClass(g),toggle:_ajaxSpinnerToggler},I.autoplayBtn={node:_getNodeByClass(_),handleButton:_autoPlayButtonHandler},I.currentTimeDisplay=_getNodeByClass(m),I.infoButton={node:_getNodeByClass(v),disable:_infoButtonHandler},I.infoScreen={node:_getNodeByClass(B),close:_infoScreenCloseHandler,open:_infoScreenOpenHandler,toggle:_infoScreenToggler},I.infoScroll=_getNodeByClass(h),I.infoScrollContent=_getNodeByClass(T),I.loadProgress={node:_getNodeByClass(k),reset:function(){this.setWidth("0")},setFullWidth:function(e){this.setWidth("100%")},setWidth:function(e){I.loadProgress.node.style.width=e}},I.muteButton={node:_getNodeByClass(S)},I.nextTrackBtn={node:_getNodeByClass(b),handleButton:function(e){_removePlayingClassFromAll(),_loadTrack(_getNextTrack())}},I.playBtn={node:_getNodeByClass(x),handleButton:async function(e){l.paused&&null==s?(s=0,_loadTrack(s)):l.paused?await _play(e):_pause(e)}},I.playlistBox=_getNodeByClass(C),I.playlistBtn={node:_getNodeByClass(E),handleButton:_loadAllPlaylistsHandler},I.prevTrackBtn={node:_getNodeByClass(P),handleSingleClick:function(e){l.currentTime=0},handleDblClick:function(e){_removePlayingClassFromAll(),_loadTrack(function _getPrevTrack(){if(s>0)return s-1;return f-1}())}},I.remainingTime=_getNodeByClass(L),I.seekHandleBox={node:_getNodeByClass(w),handleInput:function(e){l.currentTime=e.target.value},reset:function(){this.node.value=0,this.toggleEnable(!0)},setMax:function(){this.node.setAttribute("max",l.seekable.end(0))},setPosition:function(e){this.node.value=e},toggleEnable:function(e){this.node.disabled=e}},I.screenTitle=_getNodeByClass(N),I.userScreen={node:_getNodeByClass(A),reset:function(){I.seekHandleBox.reset(),I.infoScreen.close(!0),I.loadProgress.reset(),_populateTimeDisplay("00:00","00:00")}},I.volumeButton={node:_getNodeByClass(M),toggleActive:function(){I.volumeButton.node.classList.toggle("active")},toggleMute:function(e){l.muted?(l.muted=!1,I.volumeSlider.setPosition(y),d.classList.remove("muted")):(y=l.volume,l.muted=!0,I.volumeSlider.setPosition(0),d.classList.add("muted"))}},I.volumeSliderMute={node:_getNodeByClass(H),close:function(){I.volumeButton.toggleActive(),I.volumeSliderMute.node.classList.remove("play")},open:function(){I.volumeButton.toggleActive(),I.volumeSliderMute.node.classList.add("play")},toggle:function(e){I.volumeSliderMute.node.classList.contains("play")?I.volumeSliderMute.close():I.volumeSliderMute.open()}},I.volumeSlider={node:_getNodeByClass(j),handleInput:function(e){l.volume=e.target.value},setPosition:function(e){const t=parseInt(e);I.volumeSlider.node.value=t>1?1:t}}}(),c=[I.autoplayBtn.node,I.playBtn.node,I.prevTrackBtn.node,I.muteButton.node,I.nextTrackBtn.node,I.seekHandleBox.node,I.volumeSlider.node],_togglePlayerButtons(!0),I.volumeSlider.setPosition(1),I.seekHandleBox.setPosition(0),I.infoButton.disable(!0),function _connectPlayerButtons(){_attachEvents(I.autoplayBtn.node,"click",I.autoplayBtn.handleButton),_attachEvents(I.infoButton.node,"click",I.infoScreen.toggle),_attachEvents(I.nextTrackBtn.node,"click",I.nextTrackBtn.handleButton),_attachEvents(I.playBtn.node,"click",I.playBtn.handleButton),_attachEvents(I.playlistBtn.node,"click",I.playlistBtn.handleButton),_attachEvents(I.prevTrackBtn.node,"click",I.prevTrackBtn.handleSingleClick),_attachEvents(I.prevTrackBtn.node,"dblclick",I.prevTrackBtn.handleDblClick),_attachEvents(I.seekHandleBox.node,"input",I.seekHandleBox.handleInput),_attachEvents(I.muteButton.node,"click",I.volumeButton.toggleMute),_attachEvents(I.volumeButton.node,"click",I.volumeSliderMute.toggle),_attachEvents(I.volumeSlider.node,"input",I.volumeSlider.handleInput)}(),function _connectAudioEvents(){_attachEvents(l,"canplay",_play),_attachEvents(l,"ended",_handleEndOfAudioEvent),_attachEvents(l,"loadeddata",I.loadProgress.setFullWidth),_attachEvents(l,"pause",_handlePauseEvent),_attachEvents(l,"playing",_handlePlayingEvent),_attachEvents(l,"progress",_handleProgressEvent),_attachEvents(l,"timeupdate",_handleTimeUpdateEvent)}(),_renderPlaylistsList(),l}catch(e){error(e),error("Failed to initiate the Web Audio Player :(")}};function _getNodeByClass(e){return o.querySelector(`#${d.id} ${e}`)}function _ajaxSpinnerToggler(e){e?I.ajaxSpinner.node.classList.add("play"):I.ajaxSpinner.node.classList.remove("play")}function _autoPlayButtonHandler(e){i?(i=!1,d.classList.remove("autoplay")):(i=!0,d.classList.add("autoplay"))}function _infoButtonHandler(e){e?(I.infoButton.node.classList.remove("has-info"),I.infoButton.node.disabled=!0):(I.infoButton.node.classList.add("has-info"),I.infoButton.node.disabled=!1)}function _infoScreenCloseHandler(e){e&&(I.infoScreen.node.classList.add("fast"),I.infoScreen.node.classList.remove("fast")),I.infoScreen.node.classList.remove("play")}function _infoScreenOpenHandler(){I.infoScreen.node.classList.add("play")}function _infoScreenToggler(e){I.infoScreen.node.classList.contains("play")?I.infoScreen.close():I.infoScreen.open()}function _loadAllPlaylistsHandler(e){_togglePlayerButtons(!0),l.paused||_pause(),I.volumeSliderMute.close(),I.userScreen.reset(),I.infoButton.disable(!0),_renderPlaylistsList()}function _attachEvents(e,t,n){if("function"!=typeof e.addEventListener)throw new Error("Cannot attach events. Client does not support addEventListener method.");e.addEventListener(t,n,!1)}function _canPlayType(e){return l.canPlayType(e)}function _convertSecondsToTime(e,t){if(!0===t){var n=Math.floor(e/60,10),o=e-60*n;return(n>9?n:"0"+n)+":"+(o>9?o:"0"+o)}var a=parseInt(e,10),l=Math.floor(a/3600),i=Math.floor((a-3600*l)/60),s=a-3600*l-60*i;return(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)}function _createTextNode(e){return o.createTextNode(e)}function _empty(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function _getNextTrack(){var e=s+1;return e<f?e:0}async function _playlistButtonHandler(e){const t=e.target.dataset.playlist;e.preventDefault();try{const e=new URL(t);!function _handlePlaylist(e){_togglePlayerButtons(!1),u=e,_updateScreenTitle(u.name),f=u.tracks.length,function _setUpPlaylistDisplay(){_empty(I.playlistBox);for(let e=0;e<u.tracks.length;e++){const t=u.tracks[e],n=o.createElement("li"),a=_makeShortTitle(t.title),l=o.createElement("button");l.appendChild(_createTextNode(a)),l.setAttribute("data-tracknum",e),n.appendChild(l),I.playlistBox.appendChild(n),_attachEvents(l,"click",_handleLoadTrack)}}(),_populateTimeDisplay("00:00","00:00");_populateInfoBoxContent(e.info?`<p>${e.info}</p>`:"")}(await async function _loadPlaylist(e){if("string"!=typeof e||e.length<=0)throw new Error("No playlist has been defined!");return I.ajaxSpinner.toggle(!0),_togglePlayerButtons(!0),I.playlistBtn.node.classList.remove("active"),await get(e)}(e.href))}catch(e){console.error("Failed to load playlist")}}async function _renderPlaylistsList(){const e=new URL(d.dataset.playlistsUrl);0===p.length&&(p=await get(e.href)),I.playlistBtn.node.classList.add("active"),_updateScreenTitle("Playlists"),_empty(I.playlistBox);for(const e of p){const t=o.createElement("button"),n=o.createElement("li");t.appendChild(_createTextNode(e.name)),t.dataset.playlist=e.url,t.setAttribute("title",e.name),_attachEvents(t,"click",_playlistButtonHandler),n.appendChild(t),I.playlistBox.appendChild(n)}}function _handleEndOfAudioEvent(e){i&&(_removePlayingClassFromAll(),_loadTrack(_getNextTrack()))}function _handlePauseEvent(e){d.classList.remove("playing"),d.classList.add("paused")}function _handlePlayingEvent(e){var t=I.playlistBox.querySelector(`button[data-tracknum="${s}"]`).parentNode;d.classList.remove("paused"),d.classList.add("playing"),t.setAttribute("class","current")}function _handleProgressEvent(e){const t=e.target.buffered;for(let e=0;e<t.length;e++){const n=Math.ceil(parseInt(t.end(e)/t.duration*100));I.loadProgress.setWidth(n+"%")}}function _handleTimeUpdateEvent(e){const t=e.target.duration,n=e.target.currentTime,o=parseInt(t-n,10);isNaN(o)||(_populateTimeDisplay(_convertSecondsToTime(n),_convertSecondsToTime(o,!0)),I.seekHandleBox.setPosition(n))}function _populateInfoBoxContent(e){_empty(I.infoScrollContent),I.infoScrollContent.innerHTML=e,I.infoButton.disable(!1)}function _loadTrack(e){if(_pause(),I.seekHandleBox.toggleEnable(!0),I.loadProgress.reset(),s=parseInt(e),l.src=u.tracks[s].path,u.tracks[s].info.length<=0)I.infoButton.disable(!0);else{_populateInfoBoxContent(`<p>${u.tracks[s].title}</p>\n\t\t\t${u.tracks[s].info}`)}l.load()}function _pause(e){l.pause()}async function _play(e){I.seekHandleBox.toggleEnable(!1),I.seekHandleBox.setMax();try{await l.play()}catch(e){I.seekHandleBox.toggleEnable(!0)}}function _populateTimeDisplay(e,t){_empty(I.remainingTime).appendChild(_createTextNode(t)),_empty(I.currentTimeDisplay).appendChild(_createTextNode(e))}function _removePlayingClassFromAll(){d.classList.remove("playing");const e=I.playlistBox.querySelector("current");e&&e.removeAttribute("class")}function _handleLoadTrack(e){const t=parseInt(e.target.getAttribute("data-tracknum"));e.preventDefault(),_removePlayingClassFromAll(),_loadTrack(t)}function _makeShortTitle(e){if(e.length<=50)return e;const t=e.substr(0,50).split(" ");t.pop();return`${t.join(" ")}...`}function _togglePlayerButtons(e){for(const t of c)t.disabled=e}function _updateScreenTitle(e){I.screenTitle.innerHTML=e}var D=t.S1,W=t.W4,F=t.i8;export{D as init,W as startup,F as version};
//# sourceMappingURL=WebAudioPlayer.min.js.map